<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.16.4 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
   <link rel="stylesheet" href="/libs/highlight/github.min.css">
   
  <link rel="stylesheet" href="/css/franklin.css">
<link rel="stylesheet" href="/css/minimal-mistakes.css">
<link rel="stylesheet" href="/css/gmt.css">
<link rel="icon" href="/assets/GMTjl_logo.png">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/>
<!--[if IE ]>
<style>
  /* old IE unsupported flexbox fixes */
  .greedy-nav .site-title {
    padding-right: 3em;
  }
  .greedy-nav button {
    position: absolute;
    top: 0;
    right: 0;
    height: 100%;
  }
</style>
<![endif]-->

   <title>Choropleths</title>  
  <!-- end custom head snippets -->
</head>
<body class="layout--single">
  <div class="site-container">
    <div class="masthead">
    <div class="masthead__inner-wrap">
        <div class="masthead__menu">
            <nav id="site-nav" class="greedy-nav">
                <a class="title-icon" href="/"><img src="/assets/GMTjl_logo.png"/></a>
                <!-- github link -->
                

                <ul class="visible-links">
                    <li class="masthead__menu-item">
                        <a href="https://github.com/GenericMappingTools/GMTjl_doc"><img src="/assets/GitHub-Mark-64px.png" class="masthead-icon" /></a>
                    </li>
                    <li class="masthead__menu-item"><a href="/examples/">Examples</a></li>
                    <li class="masthead__menu-item"><a href="/tutorials/">Tutorials</a></li>
                    <li class="masthead__menu-item"><a href="/geophysics/">Geophysics</a></li>
                    <li class="masthead__menu-item"><a href="/documentation/">Documentation</a></li>
                </ul>
                <button class="greedy-nav__toggle" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
                <ul class="hidden-links hidden"></ul>
            </nav>
        </div>
    </div>
</div>

    
      <div id="main" role="main">
        <div id="overlay"></div>
        <div id="navbar-container">
          <div id="navbar">
            <form id="lunrSearchForm" name="lunrSearchForm" action="/search/index.html">
              <input class="search-input" name="q" placeholder="Search docs" type="text">
            </form>
            <h1>Navigation</h1>
            
          </div>
        </div>


<!-- Content appended here -->
<div class="franklin-content"><h1 id="choropleths"><a href="#choropleths" class="header-anchor">Choropleths</a></h1>
<p>A choropleth is a thematic map where areas are colored in proportion to a variable such as population density. GMT lets us plot choropleth maps but the process is not straightforward because we need to put the color information in the header of a multi-segment file. To facilitate this, some tools were added to the Julia wrapper.</p>
<p>&#40;But see also the more extended example in <a href="/tutorials/index.html#tutorials">tutorials</a>&#41;</p>
<h2 id="countries_europe_dcw"><a href="#countries_europe_dcw" class="header-anchor">Countries &#40;Europe DCW&#41;</a></h2>
<p>Load packages needed to download data and put into a DataFrame</p>
<pre><code class="language-julia">using GMT, DataFrames, CSV</code></pre>
<pre><code class="language-julia">paises &#61; CSV.File&#40;HTTP.get&#40;&quot;https://raw.githubusercontent.com/tillnagel/unfolding/master/data/data/countries-population-density.csv&quot;&#41;.body, delim&#61;&#39;;&#39;&#41; |&gt; DataFrame;</code></pre>
<p>Extract the Europe countries from the DCW file</p>
<pre><code class="language-julia">eu &#61; coast&#40;DCW&#61;&quot;&#61;EU&#43;z&quot;, dump&#61;true&#41;;</code></pre>
<p>Generate two vector with country codes &#40;2 chars codes&#41; and the population density for European countries.</p>
<pre><code class="language-julia">codes, vals &#61; GMT.mk_codes_values&#40;paises&#91;&#33;, 2&#93;, paises&#91;&#33;, 3&#93;, region&#61;&quot;eu&quot;&#41;;</code></pre>
<p>Create a Categorical CPT that allows plotting the choropleth. Note that we need to limit the CPT range to leave out the very high density states like Monaco otherwise all others would get the same color.</p>
<pre><code class="language-julia">C &#61; cpt4dcw&#40;codes, vals, range&#61;&#91;10, 500, 10&#93;&#41;;</code></pre>
<p>Show the result</p>
<pre><code class="language-julia">plot&#40;eu, cmap&#61;C, fill&#61;&quot;&#43;z&quot;, proj&#61;:guess, R&#61;&quot;-76/36/26/84&quot;, title&#61;&quot;Population density&quot;,
	colorbar&#61;true, show&#61;true&#41;</code></pre>

<img src="/assets/choro1_dcw.png" alt="DCW choropleth" title="DCW choropleth" width="500" class="center"/>

<h2 id="countries_world"><a href="#countries_world" class="header-anchor">Countries &#40;World&#41;</a></h2>
<p>While GMT come with the world countries in its DCW data base, those countries polygons have a somewhat too high resolution for world maps and hence produce files unnecessarily, which also makes them slower to create. An alternative is to use a much lower resolution file that can be found <a href="https://github.com/datasets/geo-countries/blob/master/data/countries.geojson">here</a> but whose download link is <a href="https://github.com/datasets/geo-countries/raw/master/data/countries.geojson">here</a>. And we can read it directly into GMT &#40;and wait a bit while it gets downloaded&#41;.</p>
<pre><code class="language-julia">countries &#61; gmtread&#40;&quot;/vsicurl/https://github.com/datasets/geo-countries/raw/master/data/countries.geojson&quot;&#41;;</code></pre>
<p>The country polygons have attributes like:</p>
<code>Attributes:  Dict&#40;&quot;ISO_A2&quot; &#61;&gt; &quot;AW&quot;, &quot;ISO_A3&quot; &#61;&gt; &quot;ABW&quot;, &quot;ADMIN&quot; &#61;&gt; &quot;Aruba&quot;&#41;</code>
<p>Like in the Europe case above, we load the world population into a DataFrame</p>
<pre><code class="language-julia">pop &#61; CSV.File&#40;HTTP.get&#40;&quot;https://raw.githubusercontent.com/tillnagel/unfolding/master/data/data/countries-population-density.csv&quot;&#41;.body, delim&#61;&#39;;&#39;&#41; |&gt; DataFrame;</code></pre>
<p>The contents of that file look like this:</p>
<pre><code class="language-julia">julia&gt; pop
248×3 DataFrame
 Row │ Country Name                       Country Code  2010
     │ String                             String3       Float64?
─────┼───────────────────────────────────────────────────────────
   1 │ Arab World                         ARB            26.2725
   2 │ Caribbean small states             CSS            16.9939
   3 │ East Asia &amp; Pacific &#40;all income …  EAS            90.5122</code></pre>
<p>So we must now link the countries in <code>countries</code> with density in <code>2010</code> via the attribute <code>ISO_A3</code> in <code>countries</code> and the third column in <code>pop</code>. To make a global choropleth map with the population density we will use first the <a href="#">polygonlevels</a> function to get as the population density in the same order as the country polygons are stored in the <code>countries</code> GMTdataset.</p>
<pre><code class="language-julia">zvals &#61; polygonlevels&#40;countries, string.&#40;pop&#91;&#33;,2&#93;&#41;, pop&#91;&#33;,3&#93;, att&#61;&quot;ISO_A3&quot;&#41;;</code></pre>
<p>And now we are ready to make the map</p>
<pre><code class="language-julia"># First create the colormap. Limit the maximum range to 500 otherwise states
# like Monaco would the all the &#96;reds&#96; and the rest of the world would be all blues.
C &#61; makecpt&#40;range&#61;&#40;0,500,10&#41;&#41;;
plot&#40;countries, region&#61;&#40;-180,180,-60,85&#41;, level&#61;zvals, cmap&#61;C, proj&#61;:guess,
     title&#61;&quot;World population density&quot;, colorbar&#61;true, show&#61;true&#41;</code></pre>

<img src="/assets/choro2_wpop.png" alt="World pop" title=" choropleth" width="800" class="center"/>

<h2 id="covid_rate_of_infection_in_portugal_2021"><a href="#covid_rate_of_infection_in_portugal_2021" class="header-anchor">Covid rate of infection in Portugal 2021</a></h2>
<p>First, download the Portuguese district polygons shape file from this Github repo Next load it with:</p>
<pre><code class="language-julia">using GMT, DataFrames, CSV

Pt &#61; gmtread&#40;&quot;C:\\programs\\compa_libs\\covid19pt\\extra\\mapas\\concelhos\\concelhos.shp&quot;&#41;;</code></pre>
<p>Download and load a CSV file from same repo with rate of infection per district. Load it into a DataFrame to simplify data extraction.</p>
<pre><code class="language-julia">incidence &#61; CSV.read&#40;&quot;C:\\programs\\compa_libs\\covid19pt\\data_concelhos_incidencia.csv&quot;, DataFrame&#41;;</code></pre>
<p>Get the rate of incidence in number of infected per 100_000 habitants for the last reported week.</p>
<pre><code class="language-julia">r &#61; collect&#40;incidence&#91;end, 2:end&#93;&#41;;</code></pre>
<p>But the damn polygon names above are all uppercase, Ghrrr. We will have to take care of that.</p>
<pre><code class="language-julia">ids &#61; names&#40;incidence&#41;&#91;2:end&#93;;</code></pre>
<p>Each of the Pt datasets have attributes &#40;e.g., Pt&#91;1&#93;.attrib&#41; and the one that is common with the names in ids is the <code>Pt&#91;1&#93;.attrib&#91;&quot;NAME2&quot;&#93;</code> &#40;the conselho name&#41;. But the names in <em>dataconcelhosincidencia.csv</em> &#40;from which the ids are derived&#41; and the concelhos.shp &#40;that we read into <code>Pt</code>&#41; do not use the same case &#40;one is full upper case&#41; so we need to use the <code>nocase&#61;true</code> below. The comparison is made inside the next call to the <code>polygonlevels&#40;&#41;</code> function that takes care to return the numerical vector that we need in plot&#39;s level option.</p>
<pre><code class="language-julia">zvals &#61; polygonlevels&#40;Pt, ids, r, att&#61;&quot;NAME_2&quot;, nocase&#61;true&#41;;</code></pre>
<p>Create a Colormap to paint the district polygons</p>
<pre><code class="language-julia">C &#61; makecpt&#40;range&#61;&#40;0,1500,10&#41;, inverse&#61;true, cmap&#61;:oleron, hinge&#61;240, bg&#61;:o&#41;;</code></pre>
<p>Get the date for the data being represented to use in title</p>
<pre><code class="language-julia">date &#61; incidence&#91;end,1&#93;;</code></pre>
<p>And finaly do the plot</p>
<pre><code class="language-julia">plot&#40;Pt, level&#61;zvals, cmap&#61;C, pen&#61;0.5, region&#61;&#40;-9.75,-5.9,36.9,42.1&#41;, proj&#61;:Mercator,
     title&#61;&quot;Infected / 100.000 habitants &quot; * date&#41;

colorbar&#33;&#40;pos&#61;&#40;anchor&#61;:MR,length&#61;&#40;12,0.6&#41;, offset&#61;&#40;-2.4,-4&#41;&#41;, color&#61;C,
          axes&#61;&#40;annot&#61;100,&#41;, show&#61;true&#41;</code></pre>

<img src="/assets/choropleth_cv19.png" alt="DCW choropleth" title="DCW choropleth" width="250" height="700" class="center"/>

<div class="page-foot">
  <div class="copyright">
    &copy; GMT.jl. Last modified: March 28, 2023. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
      
  </div>
</div>
</div><!-- CONTENT ENDS HERE -->

      </div> <!-- closure of main -->

      <div class="page__footer">
        <footer>
          <!-- start custom footer snippets -->
          <!-- end custom footer snippets -->
          <div class="page__footer-follow">
            <ul class="social-icons">
              <li><a href="https://twitter.com/gmt_dev" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
              <li><a href="https://github.com/GenericMappingTools/GMT.jl" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
            </ul>
          </div>
          <div class="page__footer-copyright">&copy; GMT.jl. Powered by <a href="https://github.com/tlienart/Franklin.jl">Franklin</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
        </footer>
      </div>

    </div>   <!-- closure of class site-container -->

    

    <script src="/libs/navbar.js"></script>
    <script src="/libs/lunr/lunr.min.js"></script>
    <script src="/libs/lunr/lunr_index.js"></script>
    <script src="/libs/lunr/lunrclient.min.js"></script>
    <!-- <script src="/libs/minimal-mistakes/main.min.js"></script> -->
    <script defer src="https://use.fontawesome.com/releases/v5.8.2/js/all.js" integrity="sha384-DJ25uNYET2XCl5ZF++U8eNxPWqcKohUUBUpKGlNLMchM7q4Wjg2CUpjHLaL8yYPH" crossorigin="anonymous"></script>

    
    
        <script src="/libs/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>

    
  </body>
</html>
